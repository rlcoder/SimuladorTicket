<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <!-- Cdn Bootstrap CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
  crossorigin="anonymous">
  <style media="screen">
    h1{
      text-align:  center;
    }
  </style>
  <title>Ticket System</title>
</head>
<body>
<section>
  <div class="container">
      <h3>Ticket System</h3>
      <br>
      <h4>Estacionamento</h4>
      <div id="dadosGerais" class="">
        <table class="table">
          <thead>
            <tr>
              <th>Placa</th>
              <th>Categoria</th>
              <th>Vinculo</th>
              <th>Entrada</th>
              <th>Saida</th>
              <th>Tempo de Permanencia</th>
            </tr>
          </thead>
          <tbody>
          <!-- dados  -->
          </tbody>
        </table>
      </div>
      <br>
      <h4>Estacionamento</h4>
      <br>
      <div id="estacionamento" class="">
        <table class="table">
          <thead>
            <tr>
              <th>Placa</th>
              <th>Categoria</th>
              <th>Vinculo</th>
              <th>Horario de Entrada</th>
            </tr>
          </thead>
          <tbody>
          <!-- dados  -->
          </tbody>
        </table>
      </div>
      <!-- registrar Entrada de Veiculo -->
<div class="">
  <div class="form-group">
  <label class="col-md-4 control-label" for="idEntrada">Registro de Entrada</label>
  <div class="col-md-5">
  <input id="idEntrada" name="idEntrada" type="text" placeholder="Entre com a placa do veiculo para da entrada no Estacionamento" class="form-control input-md" required="">
  <br>
  <button type="button" class="btn btn-primary" name="button">Confirmar Entrada</button>
  </div>

</div>

</div>

<!-- Text input-->
<div class="form-group">
  <label class="col-md-4 control-label" for="idSaida">Confirmar Saida</label>
  <div class="col-md-5">
  <input id="idSaida" name="idSaida" type="text" placeholder="Entre com a placa do veiculo para Registrar a saida do Estacionamento" class="form-control input-md" required="">
  <br>
  <button type="button" class="btn btn-primary" name="button">Confirmar Saida</button>
  </div>
</div>

  </div>
</section>


<!-- Cdn Bootstrap JS -->
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
<script
src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
crossorigin="anonymous">
</script>
<!-- CARRAGAMENTO JAVASCRIPT -->
<script type="text/javascript">

_retornoPesquisa = new Array();
//define um valor zero para todos os vinculo
_valoresVinculo = new Object();
_valoresVinculo.aluno = 0;
_valoresVinculo.funcionario = 0;
_valoresVinculo.professor = 0;
_valoresVinculo.visitante = 0;

//Cadastrando veiculos em array Multidimensional
var arrVeiculos =  new Array(
  ['ADB-3340','1A', 'aluno', '00:00', '00:00' ],
  ['ACD-3740','2B', 'funcionario', '00:00', '00:00'],
  ['ADB-3240','3C', 'professor', '00:00', '00:00' ],
  ['ADB-3840','4D', 'visitante', '00:00', '00:00' ]
)
var arrVeiculosNoEstacionamento  = new Array()
console.log(arrVeiculos);
//Adiciona os valores de cada categoria em um objeto
var _categoriaVeiculo = new Object();
_categoriaVeiculo.cat1A = 0.50;
_categoriaVeiculo.cat2B = 1.00;
_categoriaVeiculo.cat3C = 1.50;
_categoriaVeiculo.cat4D = 2.00;

//Adiciona os valores de descontos de acordo com o vinculo com a universidade
function vinculoUniversidade(tempo){

  //até 4 horas de permanencia
  if (tempo <=4){
    _valoresVinculo.aluno = 20;
    _valoresVinculo.funcionario = 10;
    _valoresVinculo.professor = 10;
    _valoresVinculo.visitante = 0;
  //entre 4:1 e 6 horas de permanencia
}else if  (tempo >4 && tempo <=6) {
    _valoresVinculo.aluno = 30;
    _valoresVinculo.funcionario = 10;
    _valoresVinculo.professor = 10;
    _valoresVinculo.visitante = 0;
  //mais de 6 horas de permanencia
} else if (tempo >6) {
    _valoresVinculo.aluno = 40;
    _valoresVinculo.funcionario = 40;
    _valoresVinculo.professor = 40;
    _valoresVinculo.visitante = 0;
  }
  return _valoresVinculo;
}

//Metodo para subtrair a porcentagem de vinculo
function calculoPorcentagem(valorTotalDeHoras, objComPorcentagem ){
  var valor = valorTotalDeHoras;
  var porcentagem = objComPorcentagem;
  var result, total;
  result = valor/100;
  total = valor-(porcentagem*result);
  return total
}

//Metodo para pesquisar Veiculo no Array
function pesquisarVeiculo(placaVeiculo){
  var indexVeiculo;
  var veiculoExiste = false;

     var i = 0;//Percorre o array e verifica se o veiculo existe
     while ( i < arrVeiculos.length) {
       //verifica se existe o valor dentro do array
       veiculoExiste = arrVeiculos[i].includes(placaVeiculo);
       indexVeiculo = i;//adiciona a posição  em que o valor foi encontrado
       //se o array foi encontrado para o loop
       if (veiculoExiste == true){
         break;
       }
       //incrementa a variavel
       i++;
     }

      return _retornoPesquisa = [veiculoExiste, indexVeiculo];
}

//Metodo para registrar entrada do Veiculo
function registroEntrada (placaVeiculo, horarioEntrada){
var indexVeiculo = pesquisarVeiculo(placaVeiculo)[1];
var veiculoExiste = pesquisarVeiculo(placaVeiculo)[0];

     //se o veiculoExiste for = true , adicione o horario de entrada
    if (veiculoExiste) {
       arrVeiculos[indexVeiculo][3] = horarioEntrada;
       arrVeiculosNoEstacionamento.push(arrVeiculos[indexVeiculo]);
       console.log("Veiculo Localizado:");
       console.log(arrVeiculos[indexVeiculo]);
    //se não exiba alguma mensagem ou metodo para cadastrar um veiculo
    }else {
       console.log("O Veiculo não existe, chama metodo de cadastrar");
    }

}
//Metodo para registrar saida do veiculo do Estacionamento
function saidaVeiculo(placaVeiculo, horarioSaida){
var veiculoExiste = pesquisarVeiculo(placaVeiculo)[0];
var indexVeiculo = pesquisarVeiculo(placaVeiculo)[1];
console.log(veiculoExiste);
console.log(indexVeiculo);

var i = 0;//Percorre o array e verifica se o veiculo está no array do estacionamento
while ( i < arrVeiculosNoEstacionamento.length) {
  //verifica se existe o valor dentro do array do estacionamento e armazena na variavel um valor boolean
  estaNoLocal = arrVeiculosNoEstacionamento[i].includes(placaVeiculo);
  indexArrEstacionamento = i;//adiciona a posição  em que o valor foi encontrado
  //se o array foi encontrado para o loop
  if (estaNoLocal == true){
    break;
  }
  //incrementa a variavel
  i++;
}

//se var estaNoLocal = true , adicione...
if (estaNoLocal) {
  console.log("Veiculo Localizado no Estacionamento:");
  console.log(arrVeiculosNoEstacionamento[indexArrEstacionamento]);
  //remove o carro que está no array do Estacionamento
  arrVeiculosNoEstacionamento.splice(indexArrEstacionamento,1);
  //Define o horario De Saida
  arrVeiculos[indexVeiculo][4]= horarioSaida

//se não exiba alguma mensagem informando que o veiculo não está no Estacionamento
}else {
  console.log("O este veiculo não está no Estacionamento");
}

}


/** * Verifica se a hora inicial é menor que a final. */
/* creditos função */
//http://www.sistemaseweb.com.br/Pagina/Detalhes/50/calculos-com-horas-em-javascript
function isHoraInicialMenorHoraFinal(horaInicial, horaFinal)
{
	horaIni = horaInicial.split(':'); horaFim = horaFinal.split(':');

	// Verifica as horas. Se forem diferentes, é só ver se a inicial
	// é menor que a final.
	hIni = parseInt(horaIni[0], 10);
	hFim = parseInt(horaFim[0], 10);
	if(hIni != hFim)
		return hIni < hFim;

	// Se as horas são iguais, verifica os minutos então.
	mIni = parseInt(horaIni[1], 10);
	mFim = parseInt(horaFim[1], 10);
	if(mIni != mFim)
		return mIni < mFim;
}

function diferencaHoras(horaInicial, horaFinal)
{
	// Tratamento se a hora inicial é menor que a final
	if( ! isHoraInicialMenorHoraFinal(horaInicial, horaFinal) )
	{
		aux = horaFinal;
		horaFinal = horaInicial;
		horaInicial = aux;
	}
	hIni = horaInicial.split(':');
	hFim = horaFinal.split(':');
	horasTotal = parseInt(hFim[0], 10) - parseInt(hIni[0], 10);
	minutosTotal = parseInt(hFim[1], 10) - parseInt(hIni[1], 10);
	if(minutosTotal < 0)
	{
		minutosTotal += 60; horasTotal -= 1;
	}
	horaFinal = completaZeroEsquerda(horasTotal) + ":" + completaZeroEsquerda(minutosTotal);
	return horaFinal;
}


function pegarHora(){
  //captura horario atual
  var tempo = new Date();
  var hora = tempo.getHours();
  var min  = tempo.getMinutes();
  var str_hora = hora + ':' + min;
  return str_hora;
}


function calculador(categoria, vinculo, entrada, saida){

}

//Metodo para confirma a saida do veiculo e realizar calculo
function confirmarEntrada(){

saidaVeiculo("ADB-3840","15:30");
}


//Metodo para imprimir dados na tabela
function imprimirDadosGerais(){
  i = 0;
  while (i < arrVeiculos.length) {
    $("#dadosGerais tbody").append(
      '<tr>' +
        '<td>'+ arrVeiculos[i][0] +'</td>'+
        '<td>'+ arrVeiculos[i][1] +'</td>'+
        '<td>'+ arrVeiculos[i][2] +'</td>'+
        '<td>'+ arrVeiculos[i][3] +'</td>'+
        '<td>'+ arrVeiculos[i][4] +'</td>'+
        '<td>'+ '---- ' + '</td>'+
      '</tr>'
    )
    i++
  }
}
//Metodo para imprimir dados dos carros no Estacionamento
function imprimirEstacionamento(){
  try {
    i = 0;
    while (i < arrVeiculos.length) {
      $("#estacionamento tbody").append(
        '<tr>' +
          '<td>'+ arrVeiculosNoEstacionamento[i][0] +'</td>'+
          '<td>'+ arrVeiculosNoEstacionamento[i][1] +'</td>'+
          '<td>'+ arrVeiculosNoEstacionamento[i][2] +'</td>'+
          '<td>'+ arrVeiculosNoEstacionamento[i][3] +'</td>'+
        '</tr>'
      )
      i++
    }
  } catch (e) {
    console.log("alguns itens não podem ser imprimidos" + e);
  }

}

//Registros

registroEntrada("ADB-3240","22:30");
registroEntrada("ADB-3840","20:30");
saidaVeiculo("ADB-3240",pegarHora());
imprimirDadosGerais();
imprimirEstacionamento();
console.log(pegarHora());
//saidaVeiculo("ADB-3840","15:30");


console.log(vinculoUniversidade(6));
console.log(_categoriaVeiculo);
console.log("registros:");
console.log("Carros no Estacionamento");
console.log(arrVeiculosNoEstacionamento);
console.log("Carro com hora de saida Registrada:");
console.log(arrVeiculos);
</script>
</body>
</html>
